import { zHexString } from "@filosign/shared/zod";
import { useQuery } from "@tanstack/react-query";
import z from "zod";
import { useFilosignContext } from "../../context/FilosignProvider";

export function useReceivedFiles() {
	const { api } = useFilosignContext();

	return useQuery({
		queryKey: ["received-files"],
		queryFn: async () => {
			const response = await api.rpc.getSafe(
				{
					files: z.array(
						z.object({
							pieceCid: z.string(),
							sender: z.string(),
							status: z.string(),
							encryptedEncryptionKey: zHexString(),
							kemCiphertext: zHexString(),
						}),
					),
				},
				"/files/received",
			);

			return response.data.files;
		},
	});
}
